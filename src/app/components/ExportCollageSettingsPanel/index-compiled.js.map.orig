{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;;;;;;;;;AAEA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;AACA;;AACA;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AAEA;;;;;;;;;;;;IAEM,0B;;;AACJ,wCAAqB;AAAA;;AAAA;;AAAA,sCAAN,IAAM;AAAN,UAAM;AAAA;;AAAA,mLACV,IADU;;AAEnB,UAAK,uBAAL,GAA+B,MAAK,uBAAL,CAA6B,IAA7B,OAA/B;AACA,UAAK,eAAL,GAAuB,MAAK,eAAL,CAAqB,IAArB,OAAvB;AACA,UAAK,+BAAL,GAAuC,MAAK,+BAAL,CAAqC,IAArC,OAAvC;AACA,UAAK,qCAAL,GAA6C,MAAK,qCAAL,CAA2C,IAA3C,OAA7C;AALmB;AAMpB;;;;yCAEoB;AAAA;;AACnB,WAAK,KAAL,CAAW,uCAAX;AACA,WAAK,KAAL,CAAW,8BAAX;AACA,WAAK,KAAL,CAAW,kCAAX,eAAuD,KAAK,KAAL,CAAW,YAAlE,EACG,IADH,CACQ;AAAA,eAAM,OAAK,KAAL,CAAW,wCAAX,eAA6D,OAAK,KAAL,CAAW,YAAxE,CAAN;AAAA,OADR;AAED;;;8CAEyB,S,EAAW;AAAA,mBAK/B,KAAK,KAL0B;AAAA,UAEV,WAFU,UAEjC,qBAFiC;AAAA,UAGH,qBAHG,UAGjC,4BAHiC;AAAA,UAIP,iBAJO,UAIjC,wBAJiC;AAAA,UAML,YANK,GAMW,SANX,CAM5B,qBAN4B;;AAOnC,UAAI,eAAe,YAAf,IAA+B,YAAY,EAAZ,KAAmB,aAAa,EAAnE,EAAuE;AACrE,YAAM,eAAe,KAAK,yBAAL,CAA+B,aAAa,EAA5C,CAArB;AACA,YAAI,CAAC,iBAAK,mBAAO,IAAP,EAAa,qBAAb,CAAL,EAA0C,YAA1C,CAAL,EAA8D;AAC5D,4BAAkB,aAAa,CAAb,EAAgB,EAAlC;AACD;AACF;AACF;;;6BAEQ;AAAA,oBAGuC,KAAK,KAH5C;AAAA,UACA,gCADA,WACA,gCADA;AAAA,UAEL,8BAFK,WAEL,8BAFK;AAAA,UAE2B,kCAF3B,WAE2B,kCAF3B;AAAA,UAGL,wCAHK,WAGL,wCAHK;;AAIP,UAAM,UAAU,4BAAgB,gCAAhB,EACd,8BADc,EACkB,kCADlB,EAEd,wCAFc,CAAhB;AAGA,cAAQ,QAAQ,MAAhB;AACE,aAAK,sBAAY,OAAjB;AAA0B;AACxB,mBAAO,KAAK,OAAL,EAAP;AACD;AACD,aAAK,sBAAY,OAAjB;AACE,iBAAO,sBAAU,wCAAoB,QAAQ,KAA5B,CAAV,CAAP;AACF;AACE,iBAAO,wBAAY,uBAAiB,OAA7B,CAAP;AAPJ;AASD;;;8BAES;AAAA,oBACqE,KAAK,KAD1E;AAAA,UACD,SADC,WACD,SADC;AAAA,UACU,kBADV,WACU,kBADV;AAAA,UAC8B,cAD9B,WAC8B,cAD9B;AAAA,UAC8C,mBAD9C,WAC8C,mBAD9C;;AAER,aACE;AAAA;AAAA,UAAK,WAAW,0BAAW,4BAAX,EAAyC,SAAzC,CAAhB;AACE;AAAA;AAAA,YAAK,WAAU,iBAAf;AACE;AAAA;AAAA,cAAK,WAAU,KAAf;AACE;AAAA;AAAA,gBAAK,WAAU,UAAf;AACE,+EAAuB,gBAAgB,cAAvC,EAAuD,qBAAqB,mBAA5E,EAAiG,YAAjG;AADF,aADF;AAIE;AAAA;AAAA,gBAAK,WAAU,4DAAf;AACG,mBAAK,iCAAL;AADH,aAJF;AAOE;AAAA;AAAA,gBAAK,WAAU,4BAAf;AACG,mBAAK,gCAAL;AADH,aAPF;AAUE;AAAA;AAAA,gBAAK,WAAU,UAAf;AACG,mBAAK,mBAAL;AADH;AAVF,WADF;AAeE;AAAA;AAAA,cAAK,WAAU,KAAf;AACE;AAAA;AAAA,gBAAK,WAAU,UAAf;AACG,iCAAmB,MAAnB,KAA8B,sBAAY,OAA1C,IAAqD;AADxD,aADF;AAIE;AAAA;AAAA,gBAAK,WAAU,qBAAf;AACG,iCAAmB,MAAnB,KAA8B,sBAAY,OAA1C,IAAqD;AADxD;AAJF,WAfF;AAuBE;AAAA;AAAA,cAAK,WAAU,KAAf;AACE;AAAA;AAAA,gBAAK,WAAU,UAAf;AACE;AADF,aADF;AAIE;AAAA;AAAA,gBAAK,WAAU,UAAf;AACE;AADF;AAJF,WAvBF;AA+BE;AAAA;AAAA,cAAK,WAAU,KAAf;AACE;AAAA;AAAA,gBAAK,WAAU,2BAAf;AACG,mBAAK,qCAAL;AADH;AADF;AA/BF;AADF,OADF;AAyCD;;;4DAEuC;AAAA,UACS,WADT,GACwB,KAAK,KAD7B,CAC/B,sCAD+B;;AAEtC,UAAM,eAAe,cAAc,YAAY,MAA1B,GAAmC,IAAxD;AACA,UAAM,mBAAmB,iBAAiB,sBAAY,OAAtD;AACA,aACE;AAAA;AAAA,UAAK,WAAU,KAAf;AACE;AAAA;AAAA,YAAK,OAAO,EAAC,cAAc,CAAf,EAAZ,EAA+B,WAAU,2BAAzC;AACE;AACE,sBAAU,gBADZ;AAEE,gBAAG,cAFL;AAGE,kBAAM,uBAAiB,KAHzB;AAIE,uBAAU,4BAJZ;AAKE,qBAAS,KAAK;AALhB;AADF,SADF;AAUG,4BAAoB;AAAA;AAAA,YAAK,WAAU,0BAAf;AACnB,iDAAK,OAAO,EAAC,OAAO,MAAR,EAAgB,WAAW,KAA3B,EAAZ,EAA+C,KAAK,QAAQ,0BAAR,CAApD;AADmB;AAVvB,OADF;AAgBD;;;4DAEuC;AACtC,WAAK,KAAL,CAAW,sCAAX;AACD;;;4CAEuB,Y,EAAc;AAAA,UAC7B,qBAD6B,GACJ,KAAK,KADD,CAC7B,qBAD6B;;AAEpC,UAAM,uBAAuB,iBAAK,mBAAO,IAAP,EAAa,YAAb,CAAL,EAAiC,qBAAjC,CAA7B;AACA,UAAI,CAAC,oBAAL,EAA2B;AACzB,cAAM,IAAI,KAAJ,kEAAwE,YAAxE,QAAN;AACD;AACD,cAAQ,qBAAqB,IAA7B;AACE,aAAK,uCAAkB,YAAvB;AACE,eAAK,eAAL;AACA;AACF,aAAK,uCAAkB,IAAvB;AACE,eAAK,WAAL;AACA;AACF;AACE,gBAAM,IAAI,KAAJ,gDAAsD,qBAAqB,IAA3E,QAAN;AARJ;AAUD;;;sCAEiB;AAAA,oBAE4C,KAAK,KAFjD;AAAA,UACT,gCADS,WACT,gCADS;AAAA,UACyB,qBADzB,WACyB,qBADzB;AAAA,UAEd,4BAFc,WAEd,4BAFc;AAAA,UAEgB,wBAFhB,WAEgB,wBAFhB;;AAGhB,qDAA0C,sBAAsB,EAAhE,EACG,IADH,CACQ,YAAM;AACV,YAAI,iCAAiC,sBAAI,0BAAzC,EAAqE;AACnE,mCAAyB,sBAAI,0BAA7B;AACD;AACF,OALH;AAMD;;;kCAEa;AAAA,oBAE8C,KAAK,KAFnD;AAAA,UACL,4BADK,WACL,4BADK;AAAA,UACyB,qBADzB,WACyB,qBADzB;AAAA,UAEZ,4BAFY,WAEZ,4BAFY;AAAA,UAEkB,wBAFlB,WAEkB,wBAFlB;;AAGZ,iDAAsC,sBAAsB,EAA5D,EACG,IADH,CACQ,YAAM;AACV,YAAI,iCAAiC,sBAAI,sBAAzC,EAAiE;AAC/D,mCAAyB,sBAAI,sBAA7B;AACD;AACF,OALH;AAMD;;;wDAEmC;AAAA,oBACqB,KAAK,KAD1B;AAAA,UAC3B,qBAD2B,WAC3B,qBAD2B;AAAA,UACJ,qBADI,WACJ,qBADI;;AAElC,UAAM,YAAY,kBAAM,UAAC,iBAAD,EAAoB,oBAApB,EAA6C;AACnE,gBAAQ,iBAAR;AACE,eAAK,yBAAe,QAApB;AACA,eAAK,yBAAe,QAApB;AACE,mBAAO,qBAAqB,IAArB,KAA8B,uCAAkB,YAAvD;AACF,eAAK,yBAAe,aAApB;AACE,mBAAO,qBAAqB,IAArB,KAA8B,uCAAkB,IAAvD;AACF;AACE,mBAAO,KAAP;AAPJ;AASD,OAViB,CAAlB;AAWA,UAAM,+BACJ,sBAAsB,MAAtB,CAA6B,UAAU,sBAAsB,IAAhC,CAA7B,CADF;AAEA,aACE;AACE,YAAG,iBADL;AAEE,eAAO,iCAAc,4BAAd,qBAFT;AAGE,oBAAY,KAAK,uBAHnB;AAIE,cAAM,wBAAW,uBAAiB,0BAA5B,CAJR;AAKE,kBAAU,QAAQ,sBAAR,CALZ;AAME,kBAAU,6BAA6B,MAA7B,GAAsC;AANlD,QADF;AAUD;;;yDAEoC,S,EAAW;AAAA,6BACY,UAAU,KAAV,CAAgB,GAAhB,CADZ;AAAA;AAAA,UACvC,yBADuC;AAAA,UACV,kBADU;;AAE9C,UAAI,8BAA8B,sBAAI,qBAAtC,EAA6D;AAC3D,eAAO,KAAK,yBAAL,CAA+B,kBAA/B,CAAP;AACD;AACD,UAAI,8BAA8B,sBAAI,iBAAtC,EAAyD;AACvD,eAAO,KAAK,qBAAL,CAA2B,kBAA3B,CAAP;AACD;AACD,cAAQ,MAAR,CAAe,IAAI,KAAJ,oDAA2D,SAA3D,OAAf;AACD;;;8CAEyB,c,EAAgB;AAAA,UACjC,gCADiC,GACG,KAAK,KADR,CACjC,gCADiC;;AAExC,aAAO,+CAA0C,cAA1C,CAAP;AACD;;;0CAEqB,U,EAAY;AAAA,UACzB,4BADyB,GACO,KAAK,KADZ,CACzB,4BADyB;;AAEhC,aAAO,2CAAsC,UAAtC,CAAP;AACD;;;sDAEiC;AAAA;;AAAA,oBAM5B,KAAK,KANuB;AAAA,UAE9B,eAF8B,WAE9B,eAF8B;AAAA,UAEb,oBAFa,WAEb,oBAFa;AAAA,UAG9B,4BAH8B,WAG9B,4BAH8B;AAAA,UAGA,mBAHA,WAGA,mBAHA;AAAA,UAI9B,wBAJ8B,WAI9B,wBAJ8B;AAAA,UAIwB,eAJxB,WAIJ,qBAJI,CAIoB,EAJpB;AAAA,UAK9B,kBAL8B,WAK9B,kBAL8B;;AAOhC,UAAM,4BAA4B,gBAC/B,MAD+B,CACxB;AAAA,eAAK,wBAAW,EAAE,EAAb,EAAiB,qDAAmC,eAAnC,CAAjB,KACA,wBAAW,EAAE,EAAb,EAAiB,iDAA+B,eAA/B,CAAjB,CADL;AAAA,OADwB,CAAlC;AAGA,cAAQ,GAAR,CAAY,0BACT,MADS,CACF;AAAA,eAAK,EAAE,MAAF,KAAa,4BAAlB;AAAA,OADE,EAET,MAFS,CAEF;AAAA,eAAK,EAAE,UAAP;AAAA,OAFE,EAGT,GAHS,CAGL;AAAA,eAAK,OAAK,oCAAL,CAA0C,EAAE,EAA5C,EACP,IADO,CACF;AAAA,iBAAM,qBAAqB,EAAE,EAAvB,CAAN;AAAA,SADE,CAAL;AAAA,OAHK,CAAZ,EAMG,IANH,CAMQ,YAAM;AACV,YAAI,CAAC,0BACA,MADA,CACO;AAAA,iBAAK,EAAE,MAAF,KAAa,4BAAlB;AAAA,SADP,EAEA,MAFA,CAEO;AAAA,iBAAK,CAAC,EAAE,UAAR;AAAA,SAFP,EAGA,IAHA,CAGK;AAAA,iBAAK,EAAE,MAAF,KAAa,4BAAlB;AAAA,SAHL,CAAL,EAG2D;AACzD,mCAAyB,oBAAoB,CAApB,EAAuB,EAAhD;AACD;AACF,OAbH,EAcG,IAdH,CAcQ;AAAA,eAAM,iCAA4B,eAA5B,CAAN;AAAA,OAdR;AAeD;;;uDAEkC;AAAA,oBAK7B,KAAK,KALwB;AAAA,UAEd,QAFc,WAE/B,eAF+B;AAAA,UAGD,aAHC,WAG/B,4BAH+B;AAAA,UAIH,eAJG,WAI/B,qBAJ+B,CAIP,EAJO;;AAMjC,UAAM,8BAA8B,EAAE,CAAC,kBAAkB,sBAAI,0BAAtB,IACrC,kBAAkB,sBAAI,sBADc,KACa,SAC9C,MAD8C,CACvC;AAAA,eAAK,wBAAW,EAAE,EAAb,EAAiB,qDAAmC,eAAnC,CAAjB,KACH,wBAAW,EAAE,EAAb,EAAiB,iDAA+B,eAA/B,CAAjB,CADF;AAAA,OADuC,EAG9C,IAH8C,CAGzC;AAAA,eAAK,EAAE,UAAP;AAAA,OAHyC,CADf,CAApC;AAKA,aACE;AACE,YAAG,sBADL;AAEE,cAAM,wBAAW,uBAAiB,6BAA5B,CAFR;AAGE,kBAAU,QAAQ,yBAAR,CAHZ;AAIE,kBAAU,2BAJZ;AAKE,iBAAS,KAAK;AALhB,QADF;AASD;;;8CAEyB,e,EAAiB;AAAA,oBACM,KAAK,KADX;AAAA,UAClC,mBADkC,WAClC,mBADkC;AAAA,UACb,eADa,WACb,eADa;;AAEzC,UAAM,eAAe,oBAAoB,MAApB,CAA2B;AAAA,eAC9C,gBAAgB,IAAhB,CAAqB;AAAA,iBAAW,QAAQ,MAAR,KAAmB,KAAK,EAAxB,KAC/B,CAAC,sBAAS,QAAQ,EAAjB,EAAqB,GAArB,CAAD,IAA8B,sBAAS,QAAQ,EAAjB,EAAqB,eAArB,CADC,CAAX;AAAA,SAArB,CAD8C;AAAA,OAA3B,CAArB;AAGA,aAAO,YAAP;AACD;;;0CAEqB;AAAA,qBAEc,KAAK,KAFnB;AAAA,UACb,wBADa,YACb,wBADa;AAAA,UACa,qBADb,YACa,qBADb;AAAA,UAElB,4BAFkB,YAElB,4BAFkB;;AAGpB,UAAM,eAAe,KAAK,yBAAL,CAA+B,sBAAsB,EAArD,CAArB;AACA,aACE;AACE,YAAG,mBADL;AAEE,eAAO,iCAAc,YAAd,qBAFT;AAGE,wBAAgB,4BAHlB;AAIE,oBAAY;AAJd,QADF;AAQD;;;;;;AAGH,2BAA2B,SAA3B,GAAuC;AACrC,kBAAgB,iBAAU,OAAV,CAAkB,iBAAU,KAAV,CAAgB;AAChD,QAAI,iBAAU,MAAV,CAAiB,UAD2B;AAEhD,UAAM,iBAAU,MAAV,CAAiB;AAFyB,GAAhB,CAAlB,EAGZ,UAJiC;AAKrC,uBAAqB,iBAAU,IAAV,CAAe,UALC;AAMrC,yBAAuB,iBAAU,KAAV,CAAgB;AACrC,QAAI,iBAAU,MAAV,CAAiB,UADgB;AAErC,UAAM,iBAAU,MAAV,CAAiB;AAFc,GAAhB,CANc;AAUrC,2CAAyC,iBAAU,IAAV,CAAe,UAVnB;AAWrC,oCAAkC,iBAAU,MAAV,CAAiB,UAXd;AAYrC,yBAAuB,iBAAU,OAAV,CAAkB,iBAAU,KAAV,CAAgB;AACvD,QAAI,iBAAU,MAAV,CAAiB,UADkC;AAEvD,UAAM,iBAAU,MAAV,CAAiB;AAFgC,GAAhB,CAAlB,EAGnB,UAfiC;AAgBrC,kCAAgC,iBAAU,IAAV,CAAe,UAhBV;AAiBrC,kCAAgC,iBAAU,MAAV,CAAiB,UAjBZ;AAkBrC,uBAAqB,iBAAU,OAAV,CAAkB,iBAAU,KAAV,CAAgB;AACrD,QAAI,iBAAU,MAAV,CAAiB,UADgC;AAErD,UAAM,iBAAU,MAAV,CAAiB;AAF8B,GAAhB,CAAlB,EAGjB,UArBiC;AAsBrC,gCAA8B,iBAAU,MAtBH;AAuBrC,mBAAiB,iBAAU,OAAV,CAAkB,iBAAU,MAA5B,EAAoC,UAvBhB;AAwBrC,4BAA0B,iBAAU,IAAV,CAAe,UAxBJ;AAyBrC,sCAAoC,iBAAU,IAAV,CAAe,UAzBd;AA0BrC,sCAAoC,iBAAU,MAAV,CAAiB,UA1BhB;AA2BrC,4CAA0C,iBAAU,IAAV,CAAe,UA3BpB;AA4BrC,4CAA0C,iBAAU,MAAV,CAAiB,UA5BtB;AA6BrC,gBAAc,iBAAU,MAAV,CAAiB,UA7BM;AA8BrC,aAAW,iBAAU,MA9BgB;AA+BrC,oCAAkC,iBAAU,IAAV,CAAe,UA/BZ;AAgCrC,wBAAsB,iBAAU,IAAV,CAAe,UAhCA;AAiCrC,oCAAkC,iBAAU,IAAV,CAAe,UAjCZ;AAkCrC,sBAAoB,iBAAU,IAAV,CAAe,UAlCE;AAmCrC,sBAAoB,iBAAU,MAAV,CAAiB,UAnCA;AAoCrC,gCAA8B,iBAAU,IAAV,CAAe,UApCR;AAqCrC,gCAA8B,iBAAU,IAAV,CAAe,UArCR;AAsCrC,0CAAwC,iBAAU,IAAV,CAAe,UAtClB;AAuCrC,0CAAwC,iBAAU;AAvCb,CAAvC;;AA0CA,2BAA2B,YAA3B,GAA0C;AACxC,aAAW;AAD6B,CAA1C;;AAIA,IAAM,kBAAkB,SAAlB,eAAkB;AAAA,SAAU;AAChC,oBAAgB,oBAAU,iBAAV,CAA4B,KAA5B,CADgB;AAEhC,2BAAuB,oBAAU,wBAAV,CAAmC,KAAnC,CAFS;AAGhC,sCAAkC,oBAAU,UAAV,CAAqB,KAArB,EAA4B,uBAAa,gCAAzC,CAHF;AAIhC,2BAAuB,oBAAU,+BAAV,CAA0C,KAA1C,CAJS;AAKhC,oCAAgC,oBAAU,UAAV,CAAqB,KAArB,EAA4B,uBAAa,uBAAzC,CALA;AAMhC,yBAAqB,oBAAU,sBAAV,CAAiC,KAAjC,CANW;AAOhC,kCAA8B,oBAAU,+BAAV,CAA0C,KAA1C,CAPE;AAQhC,qBAAiB,oBAAU,kBAAV,CAA6B,KAA7B,CARe;AAShC,wCAAoC,oBAAU,UAAV,CAAqB,KAArB,EAA4B,uBAAa,2BAAzC,CATJ;AAUhC,8CAA0C,oBAAU,UAAV,CAAqB,KAArB,EAA4B,uBAAa,iCAAzC,CAVV;AAWhC,kBAAc,oBAAU,uBAAV,CAAkC,KAAlC,CAXkB;AAYhC,wBAAoB,oBAAU,UAAV,CAAqB,KAArB,EAA4B,uBAAa,WAAb,CAAyB,oBAAU,0BAAV,CAAqC,KAArC,CAAzB,CAA5B,CAZY;AAahC,4CAAwC,oBAAU,UAAV,CAAqB,KAArB,EAA4B,uBAAa,+BAAzC;AAbR,GAAV;AAAA,CAAxB;;kBAgBe,yBAAQ,eAAR,qBAAyC,0BAAzC,C","file":"index-compiled.js","sourcesContent":["'use strict';\r\n\r\nimport React, {Component, PropTypes} from 'react';\r\nimport './ExportCollageSettingsPanel.css';\r\nimport ViolationTypeSelector from '../ViolationTypeSelector';\r\nimport Selector from '../Selector';\r\nimport DropdownMenuButton from '../DropdownMenuButton';\r\nimport Button from '../Button';\r\nimport CollageEditor from '../CollageEditor';\r\nimport CollageSettingsTable from '../CollageSettingsTable';\r\nimport selectors from '../../store/selectors';\r\nimport actionCreators from '../../store/actions';\r\nimport {baseUrl} from '../../api';\r\nimport {connect} from 'react-redux';\r\nimport classNames from 'classnames';\r\nimport localizedStrings, {localizeItems} from '../../localization';\r\nimport {capitalize, includes, startsWith} from 'lodash';\r\nimport {showLoading, showError} from '../Alert';\r\nimport {combineRequests} from '../../common/utils';\r\nimport statusTypes from '../../common/statusTypes';\r\nimport {requestErrorMessage} from '../../common/errorMessages';\r\nimport requestTypes from '../../common/requestTypes';\r\nimport violationTypes from '../../common/violationTypes';\r\nimport foregroundObjects from '../../common/foregroundCollageObjectTypes';\r\nimport {curry, find, propEq} from 'ramda';\r\nimport CollageSizeLabel from '../CollageSizeLabel';\r\nimport ids, {collageTrafficLightSettingIdPrefix, collageRoadSignSettingIdPrefix}\r\n  from '../../store/identifiers';\r\nimport CollageSelectedRectangleLabel from '../CollageSelectedRectangleLabel';\r\n\r\nclass ExportCollageSettingsPanel extends Component {\r\n  constructor(...args) {\r\n    super(...args);\r\n    this.onForegroundObjectAdded = this.onForegroundObjectAdded.bind(this);\r\n    this.addTrafficLight = this.addTrafficLight.bind(this);\r\n    this.handleForegroundObjectsRemoving = this.handleForegroundObjectsRemoving.bind(this);\r\n    this.handleSaveCurrentCollageConfiguration = this.handleSaveCurrentCollageConfiguration.bind(this);\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.props.requestReadForegroundCollageObjectTypes(baseUrl);\r\n    this.props.requestReadCollageSettingTypes(baseUrl);\r\n    this.props.requestReadCollageVideoExportModes(baseUrl, this.props.exportTypeId)\r\n      .then(() => this.props.requestReadCollageCurrentVideoExportMode(baseUrl, this.props.exportTypeId));\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    const {\r\n      selectedViolationType: curViolType,\r\n      selectedCollageSettingTypeId: selectedSettingTypeId,\r\n      selectCollageSettingType: selectSettingType\r\n    } = this.props;\r\n    const {selectedViolationType: nextViolType} = nextProps;\r\n    if (curViolType && nextViolType && curViolType.id !== nextViolType.id) {\r\n      const settingTypes = this.filterCollageSettingTypes(nextViolType.id);\r\n      if (!find(propEq('id', selectedSettingTypeId))(settingTypes)) {\r\n        selectSettingType(settingTypes[0].id);\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {readForegroundObjectTypesRequest,\r\n      readCollageSettingTypesRequest, readCollageVideoExportModesRequest,\r\n      readCollageCurrentVideoExportModeRequest} = this.props;\r\n    const request = combineRequests(readForegroundObjectTypesRequest,\r\n      readCollageSettingTypesRequest, readCollageVideoExportModesRequest,\r\n      readCollageCurrentVideoExportModeRequest);\r\n    switch (request.status) {\r\n      case statusTypes.Success: {\r\n        return this.content();\r\n      }\r\n      case statusTypes.Failure:\r\n        return showError(requestErrorMessage(request.error));\r\n      default:\r\n        return showLoading(localizedStrings.Loading);\r\n    }\r\n  }\r\n\r\n  content() {\r\n    const {className, readCollageRequest, violationTypes, selectViolationType} = this.props;\r\n    return (\r\n      <div className={classNames('ExportCollageSettingsPanel', className)}>\r\n        <div className=\"container-fluid\">\r\n          <div className=\"row\">\r\n            <div className=\"col-sm-4\">\r\n              <ViolationTypeSelector violationTypes={violationTypes} selectViolationType={selectViolationType} inline/>\r\n            </div>\r\n            <div className=\"col-xs-6 col-sm-2 col-sm-offset-1 col-md-offset-3 col-md-1\">\r\n              {this.foregroundObjectAdditionComponent()}\r\n            </div>\r\n            <div className=\"col-xs-6 col-sm-2 col-md-1\">\r\n              {this.foregroundObjectRemovalComponent()}\r\n            </div>\r\n            <div className=\"col-sm-3\">\r\n              {this.settingTypeSelector()}\r\n            </div>\r\n          </div>\r\n          <div className=\"row\">\r\n            <div className=\"col-sm-4\">\r\n              {readCollageRequest.status === statusTypes.Success && <CollageSizeLabel/>}\r\n            </div>\r\n            <div className=\"col-sm-5 text-right\">\r\n              {readCollageRequest.status === statusTypes.Success && <CollageSelectedRectangleLabel/>}\r\n            </div>\r\n          </div>\r\n          <div className=\"row\">\r\n            <div className=\"col-sm-9\">\r\n              <CollageEditor/>\r\n            </div>\r\n            <div className=\"col-sm-3\">\r\n              <CollageSettingsTable/>\r\n            </div>\r\n          </div>\r\n          <div className=\"row\">\r\n            <div className=\"col-sm-offset-11 col-sm-1\">\r\n              {this.saveCurrentCollageConfigurationButton()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  saveCurrentCollageConfigurationButton() {\r\n    const {saveCurrentCollageConfigurationRequest: saveRequest} = this.props;\r\n    const savingStatus = saveRequest ? saveRequest.status : null;\r\n    const savingInProgress = savingStatus === statusTypes.Pending;\r\n    return (\r\n      <div className=\"row\">\r\n        <div style={{paddingRight: 0}} className=\"col-xs-9, vertical-center\">\r\n          <Button\r\n            disabled={savingInProgress}\r\n            id=\"apply-button\"\r\n            text={localizedStrings.Apply}\r\n            className=\"margin-top-10px pull-right\"\r\n            onClick={this.handleSaveCurrentCollageConfiguration}\r\n            />\r\n        </div>\r\n        {savingInProgress && <div className=\"col-xs-2 vertical-center\">\r\n          <img style={{width: '20px', marginTop: '7px'}} src={require(\"../../images/loading.gif\")}/>\r\n        </div>}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  handleSaveCurrentCollageConfiguration() {\r\n    this.props.requestSaveCurrentCollageConfiguration(baseUrl);\r\n  }\r\n\r\n  onForegroundObjectAdded(objectTypeId) {\r\n    const {foregroundObjectTypes} = this.props;\r\n    const foregroundObjectType = find(propEq('id', objectTypeId))(foregroundObjectTypes);\r\n    if (!foregroundObjectType) {\r\n      throw new Error(`Cannot find foreground collage objects type by identifier '${objectTypeId}'`);\r\n    }\r\n    switch (foregroundObjectType.name) {\r\n      case foregroundObjects.TrafficLight:\r\n        this.addTrafficLight();\r\n        break;\r\n      case foregroundObjects.Sign:\r\n        this.addRoadSign();\r\n        break;\r\n      default:\r\n        throw new Error(`Unknown foreground collage objects type '${foregroundObjectType.name}'`);\r\n    }\r\n  }\r\n\r\n  addTrafficLight() {\r\n    const {requestCreateCollageTrafficLight, selectedViolationType,\r\n      selectedCollageSettingTypeId, selectCollageSettingType} = this.props;\r\n    requestCreateCollageTrafficLight(baseUrl, selectedViolationType.id)\r\n      .then(() => {\r\n        if (selectedCollageSettingTypeId !== ids.TrafficLightsSettingTypeId) {\r\n          selectCollageSettingType(ids.TrafficLightsSettingTypeId);\r\n        }\r\n      });\r\n  }\r\n\r\n  addRoadSign() {\r\n    const {requestCreateCollageRoadSign, selectedViolationType,\r\n    selectedCollageSettingTypeId, selectCollageSettingType} = this.props;\r\n    requestCreateCollageRoadSign(baseUrl, selectedViolationType.id)\r\n      .then(() => {\r\n        if (selectedCollageSettingTypeId !== ids.RoadSignsSettingTypeId) {\r\n          selectCollageSettingType(ids.RoadSignsSettingTypeId);\r\n        }\r\n      });\r\n  }\r\n\r\n  foregroundObjectAdditionComponent() {\r\n    const {foregroundObjectTypes, selectedViolationType} = this.props;\r\n    const enabledBy = curry((violationTypeName, foregroundObjectType) => {\r\n      switch (violationTypeName) {\r\n        case violationTypes.StopLine:\r\n        case violationTypes.RedLight:\r\n          return foregroundObjectType.name === foregroundObjects.TrafficLight;\r\n        case violationTypes.WrongLineTurn:\r\n          return foregroundObjectType.name === foregroundObjects.Sign;\r\n        default:\r\n          return false;\r\n      }\r\n    });\r\n    const enabledForegroundObjectTypes =\r\n      foregroundObjectTypes.filter(enabledBy(selectedViolationType.name));\r\n    return (\r\n      <DropdownMenuButton\r\n        id=\"add-object-menu\"\r\n        items={localizeItems(enabledForegroundObjectTypes, capitalize)}\r\n        selectItem={this.onForegroundObjectAdded}\r\n        text={capitalize(localizedStrings.AddForegroundCollageObject)}\r\n        iconPath={require(\"../../images/add.png\")}\r\n        disabled={enabledForegroundObjectTypes.length < 1}\r\n        />\r\n    );\r\n  }\r\n\r\n  requestDeleteForegroundCollageObject(settingId) {\r\n    const [foregroundObjectSettingId, , foregroundObjectId] = settingId.split('/');\r\n    if (foregroundObjectSettingId === ids.TrafficLightSettingId) {\r\n      return this.deleteCollageTrafficLight(foregroundObjectId);\r\n    }\r\n    if (foregroundObjectSettingId === ids.RoadSignSettingId) {\r\n      return this.deleteCollageRoadSign(foregroundObjectId);\r\n    }\r\n    Promise.reject(new Error(`Unknown foreground collage object (settingId: ${settingId})`));\r\n  }\r\n\r\n  deleteCollageTrafficLight(trafficLightId) {\r\n    const {requestDeleteCollageTrafficLight} = this.props;\r\n    return requestDeleteCollageTrafficLight(baseUrl, trafficLightId);\r\n  }\r\n\r\n  deleteCollageRoadSign(roadSignId) {\r\n    const {requestDeleteCollageRoadSign} = this.props;\r\n    return requestDeleteCollageRoadSign(baseUrl, roadSignId);\r\n  }\r\n\r\n  handleForegroundObjectsRemoving() {\r\n    const {\r\n      collageSettings, deleteCollageSetting,\r\n      selectedCollageSettingTypeId, collageSettingTypes,\r\n      selectCollageSettingType, selectedViolationType: {id: violationTypeId},\r\n      requestReadCollage\r\n    } = this.props;\r\n    const foregroundObjectsSettings = collageSettings\r\n      .filter(s => startsWith(s.id, collageTrafficLightSettingIdPrefix(violationTypeId)) ||\r\n                   startsWith(s.id, collageRoadSignSettingIdPrefix(violationTypeId)));\r\n    Promise.all(foregroundObjectsSettings\r\n      .filter(s => s.typeId === selectedCollageSettingTypeId)\r\n      .filter(s => s.isSelected)\r\n      .map(s => this.requestDeleteForegroundCollageObject(s.id)\r\n        .then(() => deleteCollageSetting(s.id))\r\n      ))\r\n      .then(() => {\r\n        if (!foregroundObjectsSettings\r\n            .filter(s => s.typeId === selectedCollageSettingTypeId)\r\n            .filter(s => !s.isSelected)\r\n            .some(s => s.typeId === selectedCollageSettingTypeId)) {\r\n          selectCollageSettingType(collageSettingTypes[0].id);\r\n        }\r\n      })\r\n      .then(() => requestReadCollage(baseUrl, violationTypeId));\r\n  }\r\n\r\n  foregroundObjectRemovalComponent() {\r\n    const {\r\n      collageSettings: settings,\r\n      selectedCollageSettingTypeId: settingTypeId,\r\n      selectedViolationType: {id: violationTypeId}\r\n    } = this.props;\r\n    const noForegroundObjectsToRemove = !((settingTypeId === ids.TrafficLightsSettingTypeId ||\r\n      settingTypeId === ids.RoadSignsSettingTypeId) && settings\r\n        .filter(s => startsWith(s.id, collageTrafficLightSettingIdPrefix(violationTypeId)) ||\r\n                  startsWith(s.id, collageRoadSignSettingIdPrefix(violationTypeId)))\r\n        .some(s => s.isSelected));\r\n    return (\r\n      <Button\r\n        id=\"remove-object-button\"\r\n        text={capitalize(localizedStrings.RemoveForegroundCollageObject)}\r\n        iconPath={require(\"../../images/remove.png\")}\r\n        disabled={noForegroundObjectsToRemove}\r\n        onClick={this.handleForegroundObjectsRemoving}\r\n        />\r\n    );\r\n  }\r\n\r\n  filterCollageSettingTypes(violationTypeId) {\r\n    const {collageSettingTypes, collageSettings} = this.props;\r\n    const settingTypes = collageSettingTypes.filter(type =>\r\n      collageSettings.some(setting => setting.typeId === type.id &&\r\n      (!includes(setting.id, '/') || includes(setting.id, violationTypeId))));\r\n    return settingTypes;\r\n  }\r\n\r\n  settingTypeSelector() {\r\n    const {selectCollageSettingType, selectedViolationType,\r\n      selectedCollageSettingTypeId} = this.props;\r\n    const settingTypes = this.filterCollageSettingTypes(selectedViolationType.id);\r\n    return (\r\n      <Selector\r\n        id=\"settings-selector\"\r\n        items={localizeItems(settingTypes, capitalize)}\r\n        selectedItemId={selectedCollageSettingTypeId}\r\n        selectItem={selectCollageSettingType}\r\n        />\r\n    );\r\n  }\r\n}\r\n\r\nExportCollageSettingsPanel.propTypes = {\r\n  violationTypes: PropTypes.arrayOf(PropTypes.shape({\r\n    id: PropTypes.string.isRequired,\r\n    name: PropTypes.string.isRequired\r\n  })).isRequired,\r\n  selectViolationType: PropTypes.func.isRequired,\r\n  selectedViolationType: PropTypes.shape({\r\n    id: PropTypes.string.isRequired,\r\n    name: PropTypes.string.isRequired\r\n  }),\r\n  requestReadForegroundCollageObjectTypes: PropTypes.func.isRequired,\r\n  readForegroundObjectTypesRequest: PropTypes.object.isRequired,\r\n  foregroundObjectTypes: PropTypes.arrayOf(PropTypes.shape({\r\n    id: PropTypes.string.isRequired,\r\n    name: PropTypes.string.isRequired\r\n  })).isRequired,\r\n  requestReadCollageSettingTypes: PropTypes.func.isRequired,\r\n  readCollageSettingTypesRequest: PropTypes.object.isRequired,\r\n  collageSettingTypes: PropTypes.arrayOf(PropTypes.shape({\r\n    id: PropTypes.string.isRequired,\r\n    name: PropTypes.string.isRequired\r\n  })).isRequired,\r\n  selectedCollageSettingTypeId: PropTypes.string,\r\n  collageSettings: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n  selectCollageSettingType: PropTypes.func.isRequired,\r\n  requestReadCollageVideoExportModes: PropTypes.func.isRequired,\r\n  readCollageVideoExportModesRequest: PropTypes.object.isRequired,\r\n  requestReadCollageCurrentVideoExportMode: PropTypes.func.isRequired,\r\n  readCollageCurrentVideoExportModeRequest: PropTypes.object.isRequired,\r\n  exportTypeId: PropTypes.string.isRequired,\r\n  className: PropTypes.string,\r\n  requestCreateCollageTrafficLight: PropTypes.func.isRequired,\r\n  deleteCollageSetting: PropTypes.func.isRequired,\r\n  requestDeleteCollageTrafficLight: PropTypes.func.isRequired,\r\n  requestReadCollage: PropTypes.func.isRequired,\r\n  readCollageRequest: PropTypes.object.isRequired,\r\n  requestCreateCollageRoadSign: PropTypes.func.isRequired,\r\n  requestDeleteCollageRoadSign: PropTypes.func.isRequired,\r\n  requestSaveCurrentCollageConfiguration: PropTypes.func.isRequired,\r\n  saveCurrentCollageConfigurationRequest: PropTypes.object\r\n};\r\n\r\nExportCollageSettingsPanel.defaultProps = {\r\n  className: null\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n  violationTypes: selectors.getViolationTypes(state),\r\n  selectedViolationType: selectors.getSelectedViolationType(state),\r\n  readForegroundObjectTypesRequest: selectors.getRequest(state, requestTypes.ReadForegroundCollageObjectTypes),\r\n  foregroundObjectTypes: selectors.getForegroundCollageObjectTypes(state),\r\n  readCollageSettingTypesRequest: selectors.getRequest(state, requestTypes.ReadCollageSettingTypes),\r\n  collageSettingTypes: selectors.getCollageSettingTypes(state),\r\n  selectedCollageSettingTypeId: selectors.getSelectedCollageSettingTypeId(state),\r\n  collageSettings: selectors.getCollageSettings(state),\r\n  readCollageVideoExportModesRequest: selectors.getRequest(state, requestTypes.ReadCollageVideoExportModes),\r\n  readCollageCurrentVideoExportModeRequest: selectors.getRequest(state, requestTypes.ReadCollageCurrentVideoExportMode),\r\n  exportTypeId: selectors.getSelectedExportTypeId(state),\r\n  readCollageRequest: selectors.getRequest(state, requestTypes.readCollage(selectors.getSelectedViolationTypeId(state))),\r\n  saveCurrentCollageConfigurationRequest: selectors.getRequest(state, requestTypes.SaveCurrentCollageConfiguration)\r\n});\r\n\r\nexport default connect(mapStateToProps, actionCreators)(ExportCollageSettingsPanel);\r\n"]}